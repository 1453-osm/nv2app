<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools">
    <!-- GPS konum izinleri -->
    <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />
    <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
    <!-- Android 14+: belirli FG servis türleri için özel izin -->
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE_MEDIA_PLAYBACK" />
    <!-- Kesin alarm özel erişimleri (S+ ve 14+) -->
    <uses-permission android:name="android.permission.USE_EXACT_ALARM" />
    <!-- Batarya optimizasyonlarını göz ardı etme isteği -->
    <uses-permission android:name="android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS" />
    <!-- Etkinlik hatırlatıcılar için (gerekiyorsa) -->
    <!-- Calendar permissions removed because calendar APIs are not used in the app -->
    
    <!-- Android 13+ bildirim izni -->
    <uses-permission android:name="android.permission.POST_NOTIFICATIONS" tools:targetApi="33" />
    
    <!-- Android 14 kesin alarm izni -->
    <uses-permission android:name="android.permission.SCHEDULE_EXACT_ALARM" />
    <uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED" />
    
    <!-- Lock screen widget izinleri (One UI 7 uyumluluğu için) -->
    <uses-permission android:name="android.permission.DISABLE_KEYGUARD" />
    <uses-permission android:name="android.permission.WAKE_LOCK" />
    
    <!-- Sessiz mod kontrolü için -->
    <uses-permission android:name="android.permission.MODIFY_AUDIO_SETTINGS" />
    <uses-permission android:name="android.permission.ACCESS_NOTIFICATION_POLICY" />

    <application
        android:usesCleartextTraffic="false"
        android:label="Namaz Vaktim"
        android:name="${applicationName}"
        android:icon="@mipmap/ic_launcher"
        android:networkSecurityConfig="@xml/network_security_config"
        android:largeHeap="true"
        android:hardwareAccelerated="true"
        android:allowBackup="true"
        android:fullBackupContent="true"
        android:requestLegacyExternalStorage="true"
        android:preserveLegacyExternalStorage="true">
        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:launchMode="singleTop"
            android:taskAffinity=""
            android:theme="@style/LaunchTheme"
            android:configChanges="orientation|keyboardHidden|keyboard|screenSize|smallestScreenSize|locale|layoutDirection|fontScale|screenLayout|density|uiMode"
            android:hardwareAccelerated="true"
            android:windowSoftInputMode="adjustResize"
            android:supportsPictureInPicture="false"
            android:resizeableActivity="false">
            <!-- Specifies an Android theme to apply to this Activity as soon as
                 the Android process has started. This theme is visible to the user
                 while the Flutter UI initializes. After that, this theme continues
                 to determine the Window background behind the Flutter UI. -->
            <meta-data
              android:name="io.flutter.embedding.android.NormalTheme"
              android:resource="@style/NormalTheme"
              />
            <intent-filter>
                <action android:name="android.intent.action.MAIN"/>
                <category android:name="android.intent.category.LAUNCHER"/>
            </intent-filter>
        </activity>

        <!-- Widget yapılandırma activity'si
             - Widget eklendiğinde otomatik açılmaz (configuration_optional sayesinde)
             - Widget eklendikten sonra launcher'dan configure edilebilir
             - Widget-specific ayarlar gösterir -->
        <activity
            android:name=".WidgetConfigureActivity"
            android:exported="true"
            android:noHistory="true"
            android:excludeFromRecents="true"
            android:theme="@style/WidgetConfigureTheme"
            android:launchMode="singleTop"
            android:screenOrientation="portrait">
            <intent-filter>
                <action android:name="android.appwidget.action.APPWIDGET_CONFIGURE"/>
            </intent-filter>
        </activity>

        <!-- Medya oynatma türünde ön plan hizmeti (isteğe bağlı başlatılır) -->
        <service
            android:name=".MediaPlaybackService"
            android:exported="false"
            android:foregroundServiceType="mediaPlayback" />

        <!-- Küçük App Widget tanımı -->
        <receiver
            android:name=".SmallPrayerWidgetProvider"
            android:exported="true"
            android:enabled="true"
            android:directBootAware="true">
            <intent-filter android:priority="1000">
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
                <action android:name="android.appwidget.action.APPWIDGET_ENABLED" />
                <action android:name="android.appwidget.action.APPWIDGET_DISABLED" />
                <action android:name="android.appwidget.action.APPWIDGET_OPTIONS_CHANGED" />
                <action android:name="com.osm.NamazVaktim.UPDATE_SMALL_WIDGET" />
                <action android:name="android.intent.action.USER_PRESENT" />
                <action android:name="android.intent.action.TIME_CHANGED" />
                <action android:name="android.intent.action.TIMEZONE_CHANGED" />
                <action android:name="android.intent.action.DATE_CHANGED" />
                <action android:name="android.intent.action.BOOT_COMPLETED" />
                <action android:name="android.intent.action.SCREEN_OFF" />
                <action android:name="android.intent.action.SCREEN_ON" />
                <!-- Kullanıcı ana ekrana döndüğünde (home/recent) sistem diyaloglarının kapanması yayını -->
                <action android:name="android.intent.action.CLOSE_SYSTEM_DIALOGS" />
                <!-- Koyu/açık tema dahil tüm konfigürasyon değişiklikleri -->
                <action android:name="android.intent.action.CONFIGURATION_CHANGED" />
                <!-- Özellikle Night Mode değişimini bildiren yayın -->
                <action android:name="android.app.action.UI_MODE_CHANGED" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_small_info" />
        </receiver>

        <!-- Sade metin App Widget tanımı -->
        <receiver
            android:name=".TextOnlyWidgetProvider"
            android:exported="true"
            android:enabled="true"
            android:directBootAware="true">
            <intent-filter android:priority="1000">
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
                <action android:name="android.appwidget.action.APPWIDGET_ENABLED" />
                <action android:name="android.appwidget.action.APPWIDGET_DISABLED" />
                <action android:name="android.appwidget.action.APPWIDGET_OPTIONS_CHANGED" />
                <action android:name="com.osm.NamazVaktim.UPDATE_TEXT_WIDGET" />
                <action android:name="android.intent.action.USER_PRESENT" />
                <action android:name="android.intent.action.TIME_CHANGED" />
                <action android:name="android.intent.action.TIMEZONE_CHANGED" />
                <action android:name="android.intent.action.DATE_CHANGED" />
                <action android:name="android.intent.action.BOOT_COMPLETED" />
                <action android:name="android.intent.action.SCREEN_OFF" />
                <action android:name="android.intent.action.SCREEN_ON" />
                <action android:name="android.intent.action.CLOSE_SYSTEM_DIALOGS" />
                <action android:name="android.intent.action.CONFIGURATION_CHANGED" />
                <action android:name="android.app.action.UI_MODE_CHANGED" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_textonly_info" />
        </receiver>

        <!-- Takvim App Widget tanımı -->
        <receiver
            android:name=".CalendarWidgetProvider"
            android:exported="true"
            android:enabled="true"
            android:directBootAware="true">
            <intent-filter android:priority="1000">
                <action android:name="android.appwidget.action.APPWIDGET_UPDATE" />
                <action android:name="android.appwidget.action.APPWIDGET_ENABLED" />
                <action android:name="android.appwidget.action.APPWIDGET_DISABLED" />
                <action android:name="android.appwidget.action.APPWIDGET_OPTIONS_CHANGED" />
                <action android:name="com.osm.NamazVaktim.UPDATE_CALENDAR_WIDGET" />
                <action android:name="android.intent.action.USER_PRESENT" />
                <action android:name="android.intent.action.TIME_CHANGED" />
                <action android:name="android.intent.action.TIMEZONE_CHANGED" />
                <action android:name="android.intent.action.DATE_CHANGED" />
                <action android:name="android.intent.action.BOOT_COMPLETED" />
                <action android:name="android.intent.action.SCREEN_OFF" />
                <action android:name="android.intent.action.SCREEN_ON" />
                <action android:name="android.intent.action.CLOSE_SYSTEM_DIALOGS" />
                <action android:name="android.intent.action.CONFIGURATION_CHANGED" />
                <action android:name="android.app.action.UI_MODE_CHANGED" />
            </intent-filter>
            <meta-data
                android:name="android.appwidget.provider"
                android:resource="@xml/widget_calendar_info" />
        </receiver>

        <!-- Eski uygulamadaki periyodik güncelleme alıcısı -->
        <receiver
            android:name=".WidgetUpdateReceiver"
            android:exported="false"
            android:directBootAware="true">
            <!-- UfukMarmara modeli: yalnızca AlarmManager tetikler; ek intent-filter gerekmiyor -->
        </receiver>

        <!-- Namaz vakti alarm alıcısı (uzun ses için ForegroundService başlatır) -->
        <receiver
            android:name=".PrayerAlarmReceiver"
            android:exported="false"
            android:directBootAware="true" />

        <!-- Heads-up kapatıldığında alarmı durdurmak için -->
        <receiver
            android:name=".StopAlarmReceiver"
            android:exported="false" />

        <!-- Sessiz mod için (namaz vakti girince) -->
        <receiver
            android:name=".SilentModeReceiver"
            android:exported="false"
            android:directBootAware="true" />

        <!-- Sessiz moddan çıkış için -->
        <receiver
            android:name=".SilentModeRestoreReceiver"
            android:exported="false"
            android:directBootAware="true" />

        <!-- Oto Karartma (Gece/Gündüz geçişi) için -->
        <receiver
            android:name=".AutoDarkModeReceiver"
            android:exported="false"
            android:directBootAware="true">
            <intent-filter>
                <action android:name="com.osm.NamazVaktim.ACTION_AUTO_DARK_NIGHT" />
                <action android:name="com.osm.NamazVaktim.ACTION_AUTO_DARK_SUNRISE" />
            </intent-filter>
        </receiver>

        <!-- Boot sonrası tekrar planlama -->
        <receiver
            android:name=".BootReceiver"
            android:exported="true"
            android:directBootAware="true">
            <intent-filter>
                <action android:name="android.intent.action.BOOT_COMPLETED" />
                <action android:name="android.intent.action.LOCKED_BOOT_COMPLETED" />
            </intent-filter>
        </receiver>

        <!-- Tema değişimini özel dinleyen hafif alıcı (widget provider dışında) -->
        <receiver
            android:name=".ThemeChangeReceiver"
            android:exported="true"
            android:directBootAware="true">
            <intent-filter>
                <action android:name="android.intent.action.CONFIGURATION_CHANGED" />
                <action android:name="android.app.action.UI_MODE_CHANGED" />
            </intent-filter>
        </receiver>

        <!-- WorkManager requires default Process/Service declaration implicitly via dependency; no extra manifest needed here. -->
        
        <!-- Don't delete the meta-data below.
             This is used by the Flutter tool to generate GeneratedPluginRegistrant.java -->
        <meta-data
            android:name="flutterEmbedding"
            android:value="2" />
    </application>
    <!-- Required to query activities that can process text, see:
         https://developer.android.com/training/package-visibility and
         https://developer.android.com/reference/android/content/Intent#ACTION_PROCESS_TEXT.

         In particular, this is used by the Flutter engine in io.flutter.plugin.text.ProcessTextPlugin. -->
    <queries>
        <intent>
            <action android:name="android.intent.action.PROCESS_TEXT"/>
            <data android:mimeType="text/plain"/>
        </intent>
    </queries>
</manifest>
